@if (!completed) {
<div class="auth-container">
  <div class="auth-main">
    <div class="quiz-container d-flex flex-column vh-100">

      <!-- LOADING SCREEN -->
      @if (loading) {
      <div class="overlay"></div>
      <div class="animToast quizLoader loading">
        <img src="assets/images/icons/cube.gif" class="loadingIcon">
        <h5>{{loadingText}}</h5>
        <h6>Please wait</h6>
      </div>
      }
      <!-- HEADER -->
      @if (!loading && quiz) {
      <mat-toolbar color="primary" class="toolbar justify-content-between" [class.warning]="warningActive">
        <div class="d-flex align-items-center">
          @if (quiz.image) {
          <img [src]="quiz.image" alt="icon" class="subject-icon me-2">
          }
          <span class="quiz-title">{{ quiz.title }}</span>
        </div>

        <!-- QUESTION TIMER -->
        <div class="d-flex align-items-center">
          <img src="assets/images/icons/ic_watch.png" class="timerIcon" alt="timer">

          <div class="question-timer d-flex align-items-center">
            <span>{{ questionTimeLeft }}s</span>
            
          </div>
        </div>

      </mat-toolbar>
       <mat-progress-bar mode="determinate"
              [value]="(questions[currentQuestionId]?.timeAllowed ? (questions[currentQuestionId].timeAllowed - questionTimeLeft)/questions[currentQuestionId].timeAllowed*100 : 0)">
            </mat-progress-bar>
      }

      <!-- WARNING OVERLAY -->
      @if (showWarningToast) {
      <div class="overlay"></div>
      <div class="animToast warning">
        <h5>⚠️ 10 Seconds Left!</h5>
      </div>
      }

      <!-- HINT OVERLAY -->
      @if (hintActive) {
      <div class="overlay"></div>
      <div class="animToast quizLoader hint">
        <!-- <img src="assets/images/icons/hinting.gif" class="hint-icon" alt="hint"> -->
        <h6>{{currentHint}}</h6>
        <hr class="dim-divider">
        <button mat-raised-button color="accent" (click)="hideHint()">
          Okay
        </button>
      </div>
      }

      <!-- SWIPER QUESTIONS -->
      @if (!loading) {
      <div class="flex-grow-1 overflow-hidden">
        @if (questions?.length > 0) {
        <swiper-container #swiperEx slides-per-view="1" space-between="10" allow-touch-move="false" class="h-100">

          @for (question of questions; track question.id) {
          <swiper-slide>
            <p class="col-grey text-center m-t-20 m-b-10">{{$index+1}} of {{questions?.length}}</p>

            <div class="question-card">
              <!-- Question Title -->
              @if (question.title) {
              <h5 class="mb-3">{{ question.title }}</h5>
              }
            <span class="badge level-badge position-absolute top-0 end-0 m-2"
                    [ngClass]="getLevelClass(question.level)">
                {{ getQuestionLevel(question.level) }}
              </span>
              <!-- Question Text -->
              @if (isCodeQuestion(question.question)) {
              <small>Read the question carefully and answer.</small>
              <div class="question m-b-10">
                <pre><code>{{question.question}}</code></pre>
              </div>
              }@else {
              <div class="question m-b-20" [innerHTML]="question?.question | safe:'html'"></div>
              }

              <!-- Topics -->
              @if (question?.topicsArr && question?.topicsArr.length > 0) {
              <div class="list-group-item m-b-20">
                @for (topic of question?.topicsArr; track topic) {
                <span class="badge col-indigo">{{topic}}</span>
                }
              </div>
              }

              <!-- Options -->
              @for (choice of question.options; track choice) {
              <mat-card (click)="optionSelected($event, choice.id, question)" class="choice p-2 rounded mb-2" [ngClass]="{
                    'selected': question.selectedOption === choice.id,
                    'correct': question.selectedOption === choice.id && choice.correct,
                    'wrong': question.selectedOption === choice.id && !choice.correct
                  }">
                <div class="d-flex justify-content-between align-items-center">
                  <span>{{ choice.option }}</span>
                  @if (question.selectedOption === choice.id && choice.correct) {
                  <img src="assets/images/icons/ic_correct.png" class="icon-right">
                  }
                  @if (quizConfig.mode === 'Interactive' && question.selectedOption === choice.id && !choice.correct) {
                  <img src="assets/images/icons/ic_wrong.png" class="icon-wrong">
                  }
                </div>
              </mat-card>
              }

              <!-- Celebration -->
              <app-celebration [trigger]="celebrationTrigger" (animationDone)="onCelebrationFinished()"></app-celebration>

            </div>
          </swiper-slide>
          }
        </swiper-container>
        }
      </div>
      }

      <!-- FOOTER -->
      @if (!loading) {
      <mat-toolbar color="accent" class="footer-toolbar">
        <div class="footer-actions">

          <!-- Prev -->
          @if (quizConfig.enableNavigation && currentQuestionId > 0) {
          <ng-container>
            <button mat-flat-button color="warn" (click)="onSlidePrev()">
              <mat-icon>keyboard_arrow_left</mat-icon>
              Prev
            </button>
          </ng-container>
          }

          <!-- Hint -->
          @if (quizConfig.showHint && currentQuestion?.hint !== "") {
          <ng-container>
            <button mat-raised-button color="accent" (click)="showHint()">
              <mat-icon>live_help</mat-icon> Hint
            </button>
          </ng-container>
          }

          <!-- Answer -->
          @if (quizConfig.showAnswers && currentQuestion?.answer !== "") {
          <ng-container>
            <button mat-raised-button color="accent" (click)="showAnswers()">
              Answer <mat-icon>lock</mat-icon>
            </button>
          </ng-container>
          }
          <span class="mat-spacer"></span>
          <!-- Next / Finish -->
          <button mat-flat-button color="primary" (click)="onSlideNext()" [hidden]="onSelectionPhase">
            <mat-icon>keyboard_arrow_right</mat-icon>
            {{ currentQuestionId === questions.length - 1 ? 'Finish' : 'Next' }}
          </button>

        </div>
      </mat-toolbar>
      }

    </div>
  </div>
</div>
}

<!-- QUIZ COMPLETION SCREEN -->
@if (completed) {
<div class="quiz-result-container">
  <div class="content-block">
    <div class="overlay"></div>
    <div class="animToast quizLoader hint">
      <img src="assets/images/icons/loading.gif" class="loadingIcon" alt="hint">
      <h4>Evaluating Quiz</h4>
      <h6 class="col-grey">Please wait while evaluation is in progress</h6>
    </div>
  </div>
</div>
}
